# Exercice 3.1.1-a : auditeur_forteresse

**Module :**
3.1.1 ‚Äî Principes Fondamentaux de S√©curit√©

**Concept :**
a-h ‚Äî Triade CIA, AAA, Non-r√©pudiation, Defense in Depth, Least Privilege, Separation of Duties, Zero Trust, Attack Surface

**Difficult√© :**
‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ (7/10)

**Type :**
complet

**Tiers :**
2 ‚Äî M√©lange (concepts a + b + c + d + e + f + g + h)

**Langage :**
Python 3.14

**Pr√©requis :**
- Phase 2 compl√®te (structures de donn√©es, fichiers JSON, algorithmique)
- Notions de base en s√©curit√© informatique
- Manipulation de dictionnaires imbriqu√©s en Python

**Domaines :**
Crypto, Net, FS

**Dur√©e estim√©e :**
90 min

**XP Base :**
150

**Complexit√© :**
T3 O(n√óm) √ó S2 O(n)

---

## üìê SECTION 1 : PROTOTYPE & CONSIGNE

### 1.1 Obligations

**Fichier √† rendre :**
`auditeur_forteresse.py`

**Fonctions autoris√©es :**
- `json` (module standard Python)
- `typing` (annotations de type)
- `dataclasses` (optionnel)
- Toutes fonctions Python built-in

**Fonctions interdites :**
- Biblioth√®ques tierces (requests, pandas, etc.)
- `eval()`, `exec()` (s√©curit√©)
- `pickle` (s√©rialisation non s√©curis√©e)

### 1.2 Consigne

**üéÆ CONTEXTE FUN ‚Äî R√©f√©rence : "Mr. Robot" √ó "Hackers" (1995)**

*"Tu te souviens de ce moment o√π Elliot d√©couvre que E Corp n'avait m√™me pas de segmentation r√©seau ? Ou quand Zero Cool r√©alise que la s√©curit√© du Gibson √©tait une passoire ? Aujourd'hui, c'est TOI l'auditeur."*

Tu viens d'√™tre recrut√© comme **Pentester Senior** chez **CyberShield Consulting**, la firme de s√©curit√© la plus redout√©e de Paris. Ton premier contrat : auditer **CryptoBank SA**, une startup fintech qui vient de lever 50M‚Ç¨ et qui stocke les cl√©s priv√©es de ses clients... quelque part.

Le RSSI de CryptoBank, visiblement nerveux, t'envoie un fichier JSON d√©crivant toute leur infrastructure. Il te demande un rapport complet avant la r√©union du board demain matin. Pas de pression.

**Ta mission :**

√âcrire une fonction `audit_infrastructure` qui analyse une infrastructure compl√®te et produit un rapport d'audit identifiant toutes les violations des principes fondamentaux de s√©curit√©.

**Entr√©e :**
- `infrastructure` : dictionnaire Python repr√©sentant l'infrastructure (format JSON pars√©)
  - `servers` : liste des serveurs avec leurs configurations
  - `applications` : liste des applications et leurs permissions
  - `data_flows` : flux de donn√©es entre composants
  - `users` : comptes utilisateurs et leurs privil√®ges
  - `policies` : politiques de s√©curit√© actuelles

**Sortie :**
- Dictionnaire contenant le rapport d'audit :
  - `violations` : liste des violations d√©tect√©es avec principe, localisation, s√©v√©rit√©, description, rem√©diation
  - `risk_score` : score de risque global (0-100)
  - `priority_actions` : liste ordonn√©e des actions prioritaires

**Contraintes :**
- Chaque violation doit identifier pr√©cis√©ment le principe viol√© parmi : `cia_confidentiality`, `cia_integrity`, `cia_availability`, `aaa_authentication`, `aaa_authorization`, `aaa_accounting`, `non_repudiation`, `defense_in_depth`, `least_privilege`, `separation_of_duties`, `zero_trust`, `attack_surface`
- Les s√©v√©rit√©s sont : `critical`, `high`, `medium`, `low`, `info`
- Le score de risque est calcul√© selon : critical=25pts, high=15pts, medium=8pts, low=3pts (cap √† 100)
- Les faux positifs sont p√©nalisants : attention aux configurations qui SEMBLENT vuln√©rables mais respectent un autre principe
- Le rapport doit √™tre exploitable par un outil automatis√© (structure JSON stricte)

**Exemples :**

| Entr√©e (simplifi√©e) | Violation attendue |
|---------------------|-------------------|
| User "admin" avec acc√®s root sur tous les serveurs | `least_privilege` - critical |
| M√™me personne g√®re les d√©ploiements ET les audits | `separation_of_duties` - high |
| Pas de logs sur le serveur de paiement | `aaa_accounting` - critical |
| Donn√©es client transmises en HTTP interne | `cia_confidentiality` - high |
| Un seul firewall entre Internet et la BDD | `defense_in_depth` - critical |

### 1.2.2 Consigne Acad√©mique

Impl√©menter un analyseur d'infrastructure de s√©curit√© qui :
1. Parse une structure JSON repr√©sentant une infrastructure IT
2. Identifie les violations des 8 principes fondamentaux de s√©curit√©
3. Calcule un score de risque pond√©r√©
4. G√©n√®re un rapport structur√© avec recommandations

L'algorithme doit parcourir chaque composant (serveurs, applications, flux, utilisateurs, politiques) et v√©rifier la conformit√© aux principes CIA, AAA, et aux bonnes pratiques (Defense in Depth, Least Privilege, etc.).

### 1.3 Prototype

```python
def audit_infrastructure(infrastructure: dict) -> dict:
    """
    Analyse une infrastructure et retourne un rapport d'audit de s√©curit√©.

    Args:
        infrastructure: Dictionnaire contenant servers, applications,
                       data_flows, users, policies

    Returns:
        Dictionnaire avec violations, risk_score, priority_actions
    """
    pass
```

---

## üí° SECTION 2 : LE SAVIEZ-VOUS ?

### 2.1 L'origine des principes CIA

La **triade CIA** (Confidentiality, Integrity, Availability) n'a pas √©t√© invent√©e par la CIA am√©ricaine ! Elle a √©merg√© dans les ann√©es 1970 des travaux de **Saltzer et Schroeder** au MIT, puis formalis√©e par le DoD am√©ricain dans le "Orange Book" (TCSEC) en 1983.

Fait amusant : le concept de "Least Privilege" vient du m√™me papier de 1975, "The Protection of Information in Computer Systems". Presque 50 ans plus tard, la plupart des entreprises ne l'appliquent toujours pas correctement.

### 2.2 Zero Trust : Du buzzword au standard

Le terme "Zero Trust" a √©t√© invent√© par **John Kindervag** de Forrester Research en 2010. Mais le concept existait d√©j√† dans le **Jericho Forum** (2004) sous le nom de "de-perimeterization". Google l'a impl√©ment√© sous le nom de **BeyondCorp** apr√®s l'attaque Operation Aurora de 2009.

Ironie : l'attaque qui a forc√© Google √† inventer Zero Trust venait... de Chine, ciblant les comptes Gmail d'activistes des droits de l'homme.

### 2.5 DANS LA VRAIE VIE

**Qui utilise ces concepts ?**

| M√©tier | Utilisation du concept |
|--------|----------------------|
| **RSSI / CISO** | D√©finit la politique de s√©curit√© globale, supervise les audits |
| **Pentester** | Identifie les violations en conditions r√©elles (tests d'intrusion) |
| **Auditeur SI** | V√©rifie la conformit√© aux frameworks (ISO 27001, SOC 2) |
| **Architecte S√©curit√©** | Con√ßoit les infrastructures selon Defense in Depth |
| **Analyste SOC** | D√©tecte les violations en temps r√©el via le monitoring |
| **DevSecOps** | Int√®gre les contr√¥les dans les pipelines CI/CD |

**Cas d'usage r√©el :**
Lors d'un audit PCI-DSS pour une banque, l'auditeur v√©rifie :
- Segmentation r√©seau (Defense in Depth)
- Acc√®s aux donn√©es carte bancaire (Least Privilege)
- Logs des acc√®s aux syst√®mes de paiement (AAA Accounting)
- Chiffrement des donn√©es en transit et au repos (CIA Confidentiality)

---

## üñ•Ô∏è SECTION 3 : EXEMPLE D'UTILISATION

### 3.0 Session bash

```bash
$ ls
auditeur_forteresse.py  main.py  test_infrastructure.json

$ python3 main.py

=== AUDIT CRYPTOBANK SA ===

Violations d√©tect√©es: 12
Score de risque: 87/100

[CRITICAL] least_privilege @ user:admin_bob
  ‚Üí L'utilisateur a des acc√®s root sur 15 serveurs
  ‚Üí Rem√©diation: R√©duire aux serveurs n√©cessaires uniquement

[CRITICAL] defense_in_depth @ network:dmz
  ‚Üí Un seul niveau de firewall avant la base de donn√©es
  ‚Üí Rem√©diation: Ajouter WAF et segmentation interne

[HIGH] separation_of_duties @ role:devops_team
  ‚Üí L'√©quipe d√©ploie ET approuve ses propres changements
  ‚Üí Rem√©diation: S√©parer les r√¥les deploy et approval

... (9 autres violations)

Actions prioritaires:
1. R√©voquer les acc√®s excessifs de admin_bob
2. Impl√©menter segmentation r√©seau
3. Activer les logs sur payment_server

Audit termin√© avec succ√®s.
```

### 3.1 ‚ö° BONUS STANDARD (OPTIONNEL)

**Difficult√© Bonus :**
‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (8/10)

**R√©compense :**
XP √ó2

**Time Complexity attendue :**
O(n√óm) avec cache

**Space Complexity attendue :**
O(n) pour le graphe de d√©pendances

**Domaines Bonus :**
`Struct, MD`

#### 3.1.1 Consigne Bonus

**üéÆ Extension : "Le Chasseur de Cha√Ænes"**

*Elliot ne s'arr√™te jamais √† la premi√®re vuln√©rabilit√©. Il cherche les CHA√éNES d'attaque, l√† o√π plusieurs faiblesses combin√©es permettent une compromission totale.*

En plus de l'audit de base, impl√©menter la d√©tection de **cha√Ænes de violations** : des combinaisons de faiblesses qui, ensemble, permettent un sc√©nario d'attaque complet.

**Ta mission :**

√âtendre `audit_infrastructure` pour d√©tecter les cha√Ænes d'attaque possibles.

**Entr√©e :**
- M√™me infrastructure que l'exercice de base

**Sortie :**
- Rapport √©tendu avec un champ `attack_chains` contenant :
  - `chain_id` : identifiant unique
  - `steps` : liste ordonn√©e des violations exploit√©es
  - `impact` : cons√©quence finale (data_breach, system_takeover, etc.)
  - `likelihood` : probabilit√© d'exploitation (0-100)
  - `combined_severity` : s√©v√©rit√© combin√©e

**Contraintes :**
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Cha√Æne valide : ‚â• 2 violations li√©es   ‚îÇ
‚îÇ  Impact ‚àà {data_breach, system_takeover,‚îÇ
‚îÇ            service_disruption, fraud}   ‚îÇ
‚îÇ  Temps limite : O(n√óm) avec m√©moisation ‚îÇ
‚îÇ  Pas de duplication de cha√Ænes          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

**Exemples :**

| Cha√Æne | Impact |
|--------|--------|
| weak_auth ‚Üí admin_access ‚Üí no_logging | system_takeover (likelihood: 85%) |
| http_internal ‚Üí no_encryption ‚Üí data_access | data_breach (likelihood: 70%) |

#### 3.1.2 Prototype Bonus

```python
def audit_infrastructure_extended(infrastructure: dict) -> dict:
    """
    Audit √©tendu avec d√©tection de cha√Ænes d'attaque.
    """
    pass
```

#### 3.1.3 Ce qui change par rapport √† l'exercice de base

| Aspect | Base | Bonus |
|--------|------|-------|
| Analyse | Violations individuelles | + Cha√Ænes combin√©es |
| Complexit√© | O(n√óm) | O(n√óm) avec graphe |
| Output | violations, score, actions | + attack_chains |
| Algorithme | Parcours lin√©aire | Construction de graphe + DFS |

---

## ‚úÖ‚ùå SECTION 4 : ZONE CORRECTION (POUR LE TESTEUR)

### 4.1 Moulinette

| Test ID | Input | Expected Output | Points |
|---------|-------|-----------------|--------|
| `test_null_input` | `None` | `{"violations": [], "risk_score": 0, "priority_actions": []}` | 5 |
| `test_empty_infra` | `{}` | `{"violations": [], "risk_score": 0, "priority_actions": []}` | 5 |
| `test_single_violation_least_priv` | Infrastructure avec 1 admin sur tous serveurs | 1 violation `least_privilege` critical | 10 |
| `test_single_violation_defense_depth` | 1 seul firewall | 1 violation `defense_in_depth` critical | 10 |
| `test_cia_confidentiality` | HTTP interne pour donn√©es sensibles | violation `cia_confidentiality` | 10 |
| `test_aaa_accounting` | Serveur sans logs | violation `aaa_accounting` | 10 |
| `test_separation_duties` | M√™me √©quipe deploy+approve | violation `separation_of_duties` | 10 |
| `test_complex_12_violations` | Infrastructure CryptoBank compl√®te | 12 violations exactes | 20 |
| `test_no_false_positives` | Infra avec pi√®ges (faux positifs) | 0 faux positif | 10 |
| `test_risk_score_calculation` | Mix de s√©v√©rit√©s | Score calcul√© correctement | 10 |

### 4.2 main.py de test

```python
#!/usr/bin/env python3
"""
Test runner pour auditeur_forteresse.py
"""
import json
from auditeur_forteresse import audit_infrastructure

def test_null_input():
    result = audit_infrastructure(None)
    assert result == {"violations": [], "risk_score": 0, "priority_actions": []}
    print("Test NULL: OK")

def test_empty_infrastructure():
    result = audit_infrastructure({})
    assert result == {"violations": [], "risk_score": 0, "priority_actions": []}
    print("Test Empty: OK")

def test_least_privilege_violation():
    infra = {
        "users": [
            {
                "username": "admin_bob",
                "role": "admin",
                "server_access": ["srv1", "srv2", "srv3", "srv4", "srv5",
                                  "srv6", "srv7", "srv8", "srv9", "srv10",
                                  "srv11", "srv12", "srv13", "srv14", "srv15"],
                "required_servers": ["srv1", "srv2"]
            }
        ],
        "servers": [{"name": f"srv{i}", "type": "application"} for i in range(1, 16)],
        "applications": [],
        "data_flows": [],
        "policies": {}
    }
    result = audit_infrastructure(infra)
    violations = result["violations"]
    assert len(violations) >= 1
    assert any(v["principle"] == "least_privilege" and v["severity"] == "critical"
               for v in violations)
    print("Test Least Privilege: OK")

def test_defense_in_depth_violation():
    infra = {
        "servers": [
            {"name": "web_server", "type": "web", "zone": "dmz"},
            {"name": "db_server", "type": "database", "zone": "internal"}
        ],
        "data_flows": [
            {
                "source": "internet",
                "destination": "db_server",
                "security_layers": ["firewall_external"],
                "data_classification": "confidential"
            }
        ],
        "users": [],
        "applications": [],
        "policies": {}
    }
    result = audit_infrastructure(infra)
    assert any(v["principle"] == "defense_in_depth" for v in result["violations"])
    print("Test Defense in Depth: OK")

def test_cia_confidentiality_violation():
    infra = {
        "data_flows": [
            {
                "source": "app_server",
                "destination": "payment_processor",
                "protocol": "http",
                "data_classification": "pci_dss",
                "internal": True
            }
        ],
        "servers": [],
        "users": [],
        "applications": [],
        "policies": {}
    }
    result = audit_infrastructure(infra)
    assert any(v["principle"] == "cia_confidentiality" for v in result["violations"])
    print("Test CIA Confidentiality: OK")

def test_aaa_accounting_violation():
    infra = {
        "servers": [
            {
                "name": "payment_server",
                "type": "payment",
                "logging_enabled": False,
                "data_classification": "pci_dss"
            }
        ],
        "users": [],
        "applications": [],
        "data_flows": [],
        "policies": {}
    }
    result = audit_infrastructure(infra)
    assert any(v["principle"] == "aaa_accounting" for v in result["violations"])
    print("Test AAA Accounting: OK")

def test_separation_of_duties_violation():
    infra = {
        "users": [
            {
                "username": "devops_alice",
                "roles": ["deployer", "approver", "auditor"],
                "team": "platform"
            }
        ],
        "policies": {
            "change_management": {
                "require_separate_approver": False
            }
        },
        "servers": [],
        "applications": [],
        "data_flows": []
    }
    result = audit_infrastructure(infra)
    assert any(v["principle"] == "separation_of_duties" for v in result["violations"])
    print("Test Separation of Duties: OK")

def test_risk_score_calculation():
    infra = {
        "users": [
            {"username": "admin", "server_access": ["all"], "required_servers": ["srv1"]}
        ],
        "servers": [
            {"name": "critical_server", "logging_enabled": False, "type": "payment"}
        ],
        "data_flows": [
            {"protocol": "http", "data_classification": "confidential", "source": "a", "destination": "b"}
        ],
        "applications": [],
        "policies": {}
    }
    result = audit_infrastructure(infra)
    # Au moins 2 violations critical (25 chacune) = minimum 50
    assert result["risk_score"] >= 50
    assert result["risk_score"] <= 100
    print(f"Test Risk Score: OK (score={result['risk_score']})")

def test_complex_infrastructure():
    with open("test_infrastructure.json", "r") as f:
        infra = json.load(f)
    result = audit_infrastructure(infra)
    # L'infrastructure de test contient exactement 12 violations
    assert len(result["violations"]) == 12
    assert result["risk_score"] == 87
    print("Test Complex Infrastructure: OK")

if __name__ == "__main__":
    test_null_input()
    test_empty_infrastructure()
    test_least_privilege_violation()
    test_defense_in_depth_violation()
    test_cia_confidentiality_violation()
    test_aaa_accounting_violation()
    test_separation_of_duties_violation()
    test_risk_score_calculation()
    print("\n=== Tous les tests passent! ===")
```

### 4.3 Solution de r√©f√©rence

```python
#!/usr/bin/env python3
"""
Solution de r√©f√©rence - auditeur_forteresse.py
Analyse d'infrastructure selon les principes de s√©curit√© fondamentaux
"""
from typing import Optional

SEVERITY_SCORES = {
    "critical": 25,
    "high": 15,
    "medium": 8,
    "low": 3,
    "info": 0
}

def audit_infrastructure(infrastructure: Optional[dict]) -> dict:
    """
    Analyse une infrastructure et retourne un rapport d'audit de s√©curit√©.
    """
    if infrastructure is None or not infrastructure:
        return {"violations": [], "risk_score": 0, "priority_actions": []}

    violations = []

    # Analyse des utilisateurs (Least Privilege, Separation of Duties)
    violations.extend(_audit_users(infrastructure.get("users", [])))

    # Analyse des serveurs (AAA Accounting, CIA)
    violations.extend(_audit_servers(infrastructure.get("servers", [])))

    # Analyse des flux de donn√©es (CIA Confidentiality, Defense in Depth)
    violations.extend(_audit_data_flows(
        infrastructure.get("data_flows", []),
        infrastructure.get("servers", [])
    ))

    # Analyse des politiques (Separation of Duties, Zero Trust)
    violations.extend(_audit_policies(infrastructure.get("policies", {})))

    # Analyse des applications (Attack Surface, AAA Authorization)
    violations.extend(_audit_applications(infrastructure.get("applications", [])))

    # Calcul du score de risque
    risk_score = _calculate_risk_score(violations)

    # G√©n√©ration des actions prioritaires
    priority_actions = _generate_priority_actions(violations)

    return {
        "violations": violations,
        "risk_score": risk_score,
        "priority_actions": priority_actions
    }

def _audit_users(users: list) -> list:
    """Audit des comptes utilisateurs."""
    violations = []

    for user in users:
        username = user.get("username", "unknown")

        # Least Privilege: acc√®s excessifs
        server_access = user.get("server_access", [])
        required_servers = user.get("required_servers", server_access)

        if "all" in server_access:
            violations.append({
                "principle": "least_privilege",
                "location": f"user:{username}",
                "severity": "critical",
                "description": f"L'utilisateur {username} a acc√®s √† TOUS les serveurs",
                "remediation": "Limiter l'acc√®s aux serveurs strictement n√©cessaires"
            })
        elif len(server_access) > len(required_servers) * 2:
            excess = len(server_access) - len(required_servers)
            violations.append({
                "principle": "least_privilege",
                "location": f"user:{username}",
                "severity": "critical" if excess > 10 else "high",
                "description": f"L'utilisateur a acc√®s √† {excess} serveurs non n√©cessaires",
                "remediation": f"R√©voquer l'acc√®s aux serveurs non requis"
            })

        # Separation of Duties: cumul de r√¥les incompatibles
        roles = user.get("roles", [])
        incompatible_pairs = [
            ({"deployer", "approver"}, "deploy et approval"),
            ({"developer", "auditor"}, "d√©veloppement et audit"),
            ({"admin", "auditor"}, "administration et audit")
        ]

        for pair, description in incompatible_pairs:
            if pair.issubset(set(roles)):
                violations.append({
                    "principle": "separation_of_duties",
                    "location": f"user:{username}",
                    "severity": "high",
                    "description": f"Cumul de r√¥les incompatibles: {description}",
                    "remediation": f"S√©parer les r√¥les {description} entre diff√©rentes personnes"
                })

    return violations

def _audit_servers(servers: list) -> list:
    """Audit des serveurs."""
    violations = []

    for server in servers:
        name = server.get("name", "unknown")
        server_type = server.get("type", "generic")

        # AAA Accounting: absence de logs sur serveurs critiques
        logging_enabled = server.get("logging_enabled", True)
        data_classification = server.get("data_classification", "internal")

        critical_types = ["payment", "database", "authentication", "api_gateway"]
        sensitive_classifications = ["pci_dss", "confidential", "secret", "phi"]

        if not logging_enabled:
            if server_type in critical_types or data_classification in sensitive_classifications:
                violations.append({
                    "principle": "aaa_accounting",
                    "location": f"server:{name}",
                    "severity": "critical",
                    "description": f"Logs d√©sactiv√©s sur serveur critique ({server_type})",
                    "remediation": "Activer les logs et les centraliser dans un SIEM"
                })
            else:
                violations.append({
                    "principle": "aaa_accounting",
                    "location": f"server:{name}",
                    "severity": "medium",
                    "description": "Logs d√©sactiv√©s",
                    "remediation": "Activer les logs pour tra√ßabilit√©"
                })

        # CIA Availability: pas de haute disponibilit√© pour serveurs critiques
        ha_enabled = server.get("high_availability", False)
        if server_type in critical_types and not ha_enabled:
            violations.append({
                "principle": "cia_availability",
                "location": f"server:{name}",
                "severity": "high",
                "description": f"Pas de haute disponibilit√© sur serveur {server_type}",
                "remediation": "Impl√©menter clustering ou r√©plication"
            })

    return violations

def _audit_data_flows(data_flows: list, servers: list) -> list:
    """Audit des flux de donn√©es."""
    violations = []
    server_zones = {s.get("name"): s.get("zone", "unknown") for s in servers}

    for flow in data_flows:
        source = flow.get("source", "unknown")
        destination = flow.get("destination", "unknown")
        protocol = flow.get("protocol", "https")
        classification = flow.get("data_classification", "public")
        security_layers = flow.get("security_layers", [])

        # CIA Confidentiality: donn√©es sensibles en HTTP
        sensitive_classifications = ["confidential", "secret", "pci_dss", "phi", "pii"]
        if protocol.lower() == "http" and classification in sensitive_classifications:
            violations.append({
                "principle": "cia_confidentiality",
                "location": f"flow:{source}->{destination}",
                "severity": "critical" if classification == "pci_dss" else "high",
                "description": f"Donn√©es {classification} transmises en HTTP non chiffr√©",
                "remediation": "Impl√©menter TLS/HTTPS pour ce flux"
            })

        # Defense in Depth: acc√®s direct depuis internet vers donn√©es sensibles
        if source == "internet" or source.startswith("external"):
            dest_zone = server_zones.get(destination, "unknown")
            if len(security_layers) < 2:
                violations.append({
                    "principle": "defense_in_depth",
                    "location": f"flow:{source}->{destination}",
                    "severity": "critical",
                    "description": f"Seulement {len(security_layers)} couche(s) de s√©curit√© vers {destination}",
                    "remediation": "Ajouter WAF, IDS/IPS, et segmentation r√©seau"
                })

    return violations

def _audit_policies(policies: dict) -> list:
    """Audit des politiques de s√©curit√©."""
    violations = []

    # Change Management
    change_mgmt = policies.get("change_management", {})
    if not change_mgmt.get("require_separate_approver", True):
        violations.append({
            "principle": "separation_of_duties",
            "location": "policy:change_management",
            "severity": "high",
            "description": "Les changements peuvent √™tre auto-approuv√©s",
            "remediation": "Exiger un approbateur distinct du demandeur"
        })

    # Zero Trust
    network_policy = policies.get("network", {})
    if network_policy.get("trust_internal", True):
        violations.append({
            "principle": "zero_trust",
            "location": "policy:network",
            "severity": "high",
            "description": "Le r√©seau interne est consid√©r√© comme de confiance",
            "remediation": "Impl√©menter v√©rification pour tout trafic, m√™me interne"
        })

    # Authentication
    auth_policy = policies.get("authentication", {})
    if not auth_policy.get("mfa_required", True):
        violations.append({
            "principle": "aaa_authentication",
            "location": "policy:authentication",
            "severity": "high",
            "description": "MFA non obligatoire",
            "remediation": "Activer MFA pour tous les comptes"
        })

    return violations

def _audit_applications(applications: list) -> list:
    """Audit des applications."""
    violations = []

    for app in applications:
        name = app.get("name", "unknown")
        exposed_ports = app.get("exposed_ports", [])
        public_endpoints = app.get("public_endpoints", [])
        auth_required = app.get("authentication_required", True)

        # Attack Surface: trop de ports expos√©s
        if len(exposed_ports) > 3:
            violations.append({
                "principle": "attack_surface",
                "location": f"app:{name}",
                "severity": "medium",
                "description": f"{len(exposed_ports)} ports expos√©s",
                "remediation": "R√©duire les ports expos√©s au strict minimum"
            })

        # AAA Authorization: endpoints publics sans auth
        if public_endpoints and not auth_required:
            violations.append({
                "principle": "aaa_authorization",
                "location": f"app:{name}",
                "severity": "high",
                "description": "Endpoints publics sans authentification",
                "remediation": "Impl√©menter authentification sur tous les endpoints"
            })

    return violations

def _calculate_risk_score(violations: list) -> int:
    """Calcule le score de risque total (cap √† 100)."""
    total = sum(SEVERITY_SCORES.get(v.get("severity", "info"), 0) for v in violations)
    return min(total, 100)

def _generate_priority_actions(violations: list) -> list:
    """G√©n√®re les actions prioritaires bas√©es sur les violations."""
    # Trier par s√©v√©rit√© (critical > high > medium > low > info)
    severity_order = {"critical": 0, "high": 1, "medium": 2, "low": 3, "info": 4}
    sorted_violations = sorted(
        violations,
        key=lambda v: severity_order.get(v.get("severity", "info"), 5)
    )

    # Extraire les rem√©diations uniques
    seen = set()
    actions = []
    for v in sorted_violations:
        remediation = v.get("remediation", "")
        if remediation and remediation not in seen:
            seen.add(remediation)
            actions.append(remediation)
            if len(actions) >= 5:  # Top 5 actions
                break

    return actions
```

### 4.4 Solutions alternatives accept√©es

```python
# Alternative 1 : Approche orient√©e objet avec classes
class SecurityAuditor:
    def __init__(self, infrastructure):
        self.infra = infrastructure or {}
        self.violations = []

    def audit(self):
        if not self.infra:
            return {"violations": [], "risk_score": 0, "priority_actions": []}

        self._check_least_privilege()
        self._check_defense_in_depth()
        self._check_cia()
        self._check_aaa()
        self._check_separation_duties()

        return {
            "violations": self.violations,
            "risk_score": self._calc_score(),
            "priority_actions": self._get_actions()
        }
    # ... m√©thodes priv√©es

def audit_infrastructure(infrastructure):
    return SecurityAuditor(infrastructure).audit()
```

```python
# Alternative 2 : Approche fonctionnelle avec r√®gles configurables
AUDIT_RULES = [
    ("least_privilege", check_least_privilege),
    ("defense_in_depth", check_defense_in_depth),
    # ...
]

def audit_infrastructure(infrastructure):
    if not infrastructure:
        return {"violations": [], "risk_score": 0, "priority_actions": []}

    violations = []
    for principle, check_fn in AUDIT_RULES:
        violations.extend(check_fn(infrastructure))

    return {
        "violations": violations,
        "risk_score": min(sum(SCORES[v["severity"]] for v in violations), 100),
        "priority_actions": [v["remediation"] for v in sorted(violations, key=lambda x: SEVERITY_ORDER[x["severity"]])[:5]]
    }
```

### 4.5 Solutions refus√©es (avec explications)

```python
# REFUS√â 1 : Ne g√®re pas les entr√©es nulles/vides
def audit_infrastructure(infrastructure):
    violations = []
    for user in infrastructure["users"]:  # Crash si infrastructure None ou sans "users"
        # ...
# Pourquoi refus√© : KeyError ou TypeError sur entr√©es invalides

# REFUS√â 2 : Hardcode les violations sans analyse
def audit_infrastructure(infrastructure):
    return {
        "violations": [{"principle": "least_privilege", "severity": "critical"}],
        "risk_score": 25,
        "priority_actions": ["Fix security"]
    }
# Pourquoi refus√© : Ne fait aucune analyse r√©elle de l'infrastructure

# REFUS√â 3 : Retourne des faux positifs
def audit_infrastructure(infrastructure):
    violations = []
    for user in infrastructure.get("users", []):
        # Signale TOUT utilisateur comme violation
        violations.append({"principle": "least_privilege", ...})
# Pourquoi refus√© : Pas de v√©rification des acc√®s r√©els vs n√©cessaires

# REFUS√â 4 : Mauvais calcul du score de risque
def audit_infrastructure(infrastructure):
    # ...
    risk_score = len(violations) * 10  # Pas de pond√©ration par s√©v√©rit√©
# Pourquoi refus√© : Le score ne refl√®te pas la gravit√© r√©elle
```

### 4.6 Solution bonus de r√©f√©rence (COMPL√àTE)

```python
#!/usr/bin/env python3
"""
Solution bonus - D√©tection de cha√Ænes d'attaque
"""
from typing import Optional, List, Dict, Set, Tuple
from collections import defaultdict

def audit_infrastructure_extended(infrastructure: Optional[dict]) -> dict:
    """
    Audit √©tendu avec d√©tection de cha√Ænes d'attaque.
    """
    # Audit de base
    base_result = audit_infrastructure(infrastructure)

    if not infrastructure or not base_result["violations"]:
        base_result["attack_chains"] = []
        return base_result

    # Construire le graphe de violations
    attack_chains = _detect_attack_chains(
        base_result["violations"],
        infrastructure
    )

    base_result["attack_chains"] = attack_chains
    return base_result

def _detect_attack_chains(violations: List[dict], infra: dict) -> List[dict]:
    """
    D√©tecte les cha√Ænes d'attaque en construisant un graphe de d√©pendances.
    """
    chains = []

    # D√©finir les relations causales entre types de violations
    CAUSAL_RELATIONS = {
        "aaa_authentication": ["least_privilege", "aaa_authorization"],
        "least_privilege": ["cia_confidentiality", "cia_integrity"],
        "defense_in_depth": ["cia_confidentiality", "cia_availability"],
        "zero_trust": ["least_privilege", "cia_confidentiality"],
        "aaa_authorization": ["cia_confidentiality", "cia_integrity"],
        "separation_of_duties": ["cia_integrity", "non_repudiation"],
    }

    IMPACT_MAPPING = {
        ("aaa_authentication", "cia_confidentiality"): "data_breach",
        ("least_privilege", "cia_confidentiality"): "data_breach",
        ("defense_in_depth", "cia_confidentiality"): "data_breach",
        ("aaa_authentication", "least_privilege"): "system_takeover",
        ("zero_trust", "least_privilege"): "system_takeover",
        ("separation_of_duties", "cia_integrity"): "fraud",
        ("defense_in_depth", "cia_availability"): "service_disruption",
    }

    # Indexer les violations par principe
    violations_by_principle = defaultdict(list)
    for v in violations:
        violations_by_principle[v["principle"]].append(v)

    chain_id = 0
    seen_chains: Set[Tuple] = set()

    # Chercher les cha√Ænes
    for v1 in violations:
        p1 = v1["principle"]
        if p1 not in CAUSAL_RELATIONS:
            continue

        for p2 in CAUSAL_RELATIONS[p1]:
            if p2 in violations_by_principle:
                for v2 in violations_by_principle[p2]:
                    # V√©rifier la proximit√© (m√™me zone, m√™me application, etc.)
                    if _are_related(v1, v2, infra):
                        chain_key = (p1, p2, v1["location"], v2["location"])
                        if chain_key not in seen_chains:
                            seen_chains.add(chain_key)

                            impact = IMPACT_MAPPING.get(
                                (p1, p2),
                                "unknown_impact"
                            )

                            likelihood = _calculate_likelihood(v1, v2)
                            combined_severity = _combine_severity(
                                v1["severity"],
                                v2["severity"]
                            )

                            chains.append({
                                "chain_id": f"CHAIN-{chain_id:03d}",
                                "steps": [
                                    {"violation": v1, "order": 1},
                                    {"violation": v2, "order": 2}
                                ],
                                "impact": impact,
                                "likelihood": likelihood,
                                "combined_severity": combined_severity
                            })
                            chain_id += 1

    # Trier par likelihood d√©croissante
    chains.sort(key=lambda c: c["likelihood"], reverse=True)
    return chains

def _are_related(v1: dict, v2: dict, infra: dict) -> bool:
    """V√©rifie si deux violations sont li√©es (m√™me contexte)."""
    loc1 = v1.get("location", "")
    loc2 = v2.get("location", "")

    # M√™me composant
    if loc1.split(":")[1] == loc2.split(":")[1]:
        return True

    # M√™me zone r√©seau
    servers = {s["name"]: s.get("zone", "") for s in infra.get("servers", [])}
    comp1 = loc1.split(":")[1] if ":" in loc1 else ""
    comp2 = loc2.split(":")[1] if ":" in loc2 else ""

    if servers.get(comp1) == servers.get(comp2) and servers.get(comp1):
        return True

    # Flux de donn√©es entre les composants
    for flow in infra.get("data_flows", []):
        if (comp1 in [flow.get("source"), flow.get("destination")] and
            comp2 in [flow.get("source"), flow.get("destination")]):
            return True

    return False

def _calculate_likelihood(v1: dict, v2: dict) -> int:
    """Calcule la probabilit√© d'exploitation de la cha√Æne."""
    base_likelihood = {
        "critical": 90,
        "high": 70,
        "medium": 50,
        "low": 30,
        "info": 10
    }

    l1 = base_likelihood.get(v1["severity"], 50)
    l2 = base_likelihood.get(v2["severity"], 50)

    # La cha√Æne est aussi forte que son maillon le plus faible
    # Mais deux faiblesses combin√©es augmentent la probabilit√©
    combined = min(l1, l2) + (max(l1, l2) - min(l1, l2)) // 3
    return min(combined, 100)

def _combine_severity(s1: str, s2: str) -> str:
    """Combine deux s√©v√©rit√©s pour obtenir la s√©v√©rit√© de la cha√Æne."""
    order = ["info", "low", "medium", "high", "critical"]
    i1 = order.index(s1) if s1 in order else 2
    i2 = order.index(s2) if s2 in order else 2

    combined_index = min(max(i1, i2) + 1, 4)  # Escalade d'un niveau
    return order[combined_index]
```

### 4.7 Solutions alternatives bonus (COMPL√àTES)

```python
# Alternative bonus : Utilisation de NetworkX pour le graphe
import networkx as nx

def audit_infrastructure_extended(infrastructure):
    base = audit_infrastructure(infrastructure)
    if not base["violations"]:
        base["attack_chains"] = []
        return base

    G = nx.DiGraph()
    for v in base["violations"]:
        G.add_node(v["location"], **v)

    # Ajouter les ar√™tes bas√©es sur les relations causales
    # ... construction du graphe

    # Trouver tous les chemins d'attaque via DFS
    chains = []
    for source in G.nodes():
        for target in G.nodes():
            if source != target:
                for path in nx.all_simple_paths(G, source, target, cutoff=4):
                    # ... construire la cha√Æne

    base["attack_chains"] = chains
    return base
```

### 4.8 Solutions refus√©es bonus (COMPL√àTES)

```python
# REFUS√â : G√©n√®re des cha√Ænes sans v√©rifier la causalit√©
def audit_infrastructure_extended(infrastructure):
    base = audit_infrastructure(infrastructure)
    # Combine simplement toutes les paires de violations
    chains = []
    for i, v1 in enumerate(base["violations"]):
        for v2 in base["violations"][i+1:]:
            chains.append({
                "chain_id": f"CHAIN-{len(chains)}",
                "steps": [v1, v2],
                "impact": "unknown"
            })
    base["attack_chains"] = chains
    return base
# Pourquoi refus√© : Pas de v√©rification de relation causale entre violations
```

### 4.9 spec.json (ENGINE v22.1 ‚Äî FORMAT STRICT)

```json
{
  "name": "auditeur_forteresse",
  "language": "python",
  "type": "code",
  "tier": 2,
  "tier_info": "M√©lange (concepts a-h)",
  "tags": ["security", "audit", "cia", "aaa", "defense-in-depth", "phase3"],
  "passing_score": 70,

  "function": {
    "name": "audit_infrastructure",
    "prototype": "def audit_infrastructure(infrastructure: dict) -> dict",
    "return_type": "dict",
    "parameters": [
      {"name": "infrastructure", "type": "dict"}
    ]
  },

  "driver": {
    "reference": "def ref_audit_infrastructure(infrastructure): violations = []; return {'violations': violations, 'risk_score': min(sum(25 if v['severity']=='critical' else 15 if v['severity']=='high' else 8 if v['severity']=='medium' else 3 for v in violations), 100), 'priority_actions': [v['remediation'] for v in sorted(violations, key=lambda x: ['critical','high','medium','low','info'].index(x['severity']))[:5]]} if infrastructure else {'violations': [], 'risk_score': 0, 'priority_actions': []}",

    "edge_cases": [
      {
        "name": "null_input",
        "args": [null],
        "expected": {"violations": [], "risk_score": 0, "priority_actions": []},
        "is_trap": true,
        "trap_explanation": "infrastructure est None, doit retourner un rapport vide"
      },
      {
        "name": "empty_dict",
        "args": [{}],
        "expected": {"violations": [], "risk_score": 0, "priority_actions": []},
        "is_trap": true,
        "trap_explanation": "infrastructure vide, pas de violations"
      },
      {
        "name": "least_privilege_violation",
        "args": [{"users": [{"username": "admin", "server_access": ["all"], "required_servers": ["srv1"]}], "servers": [], "applications": [], "data_flows": [], "policies": {}}],
        "expected_contains": {"principle": "least_privilege"},
        "is_trap": false
      },
      {
        "name": "no_false_positive_trap",
        "args": [{"users": [{"username": "limited_user", "server_access": ["srv1"], "required_servers": ["srv1"]}], "servers": [], "applications": [], "data_flows": [], "policies": {}}],
        "expected": {"violations": [], "risk_score": 0, "priority_actions": []},
        "is_trap": true,
        "trap_explanation": "Configuration correcte ne doit pas g√©n√©rer de violation"
      }
    ],

    "fuzzing": {
      "enabled": true,
      "iterations": 500,
      "generators": [
        {
          "type": "object",
          "param_index": 0,
          "params": {
            "schema": {
              "users": {"type": "array", "items": {"type": "object"}},
              "servers": {"type": "array", "items": {"type": "object"}},
              "data_flows": {"type": "array", "items": {"type": "object"}},
              "policies": {"type": "object"}
            }
          }
        }
      ]
    }
  },

  "norm": {
    "allowed_functions": ["json.load", "json.loads", "json.dump", "json.dumps"],
    "forbidden_functions": ["eval", "exec", "pickle.load", "pickle.loads", "os.system", "subprocess.call"],
    "check_security": true,
    "check_memory": false,
    "blocking": true
  }
}
```

### 4.10 Solutions Mutantes (minimum 5)

```python
# Mutant A (Boundary) : Mauvais seuil pour Least Privilege
def audit_infrastructure(infrastructure):
    if not infrastructure:
        return {"violations": [], "risk_score": 0, "priority_actions": []}

    violations = []
    for user in infrastructure.get("users", []):
        server_access = user.get("server_access", [])
        required = user.get("required_servers", server_access)
        # BUG: > au lieu de >= double le seuil
        if len(server_access) > len(required) * 3:  # Devrait √™tre * 2
            violations.append({"principle": "least_privilege", "severity": "critical", ...})
    # ...
# Pourquoi c'est faux : Ne d√©tecte pas les violations mod√©r√©es
# Ce qui √©tait pens√© : "Un peu d'exc√®s n'est pas grave"
```

```python
# Mutant B (Safety) : Ne v√©rifie pas les cl√©s manquantes
def audit_infrastructure(infrastructure):
    violations = []
    # BUG: Pas de v√©rification si infrastructure est None
    for user in infrastructure["users"]:  # KeyError si cl√© absente
        # ...
# Pourquoi c'est faux : Crash sur entr√©e invalide
# Ce qui √©tait pens√© : "L'appelant passera toujours une structure valide"
```

```python
# Mutant C (Resource) : Fuite m√©moire avec cache non born√©
def audit_infrastructure(infrastructure):
    # BUG: Cache global qui grandit ind√©finiment
    global _cache
    if not hasattr(audit_infrastructure, '_cache'):
        audit_infrastructure._cache = {}

    key = str(infrastructure)
    if key not in audit_infrastructure._cache:
        audit_infrastructure._cache[key] = _compute_audit(infrastructure)
    return audit_infrastructure._cache[key]
# Pourquoi c'est faux : M√©moire non lib√©r√©e entre appels
# Ce qui √©tait pens√© : "Le cache acc√©l√®re les audits r√©p√©t√©s"
```

```python
# Mutant D (Logic) : Inversion de la logique de s√©v√©rit√©
def _calculate_risk_score(violations):
    total = 0
    for v in violations:
        # BUG: Logique invers√©e - critical a le moins de points
        if v["severity"] == "critical":
            total += 3  # Devrait √™tre 25
        elif v["severity"] == "high":
            total += 8  # Devrait √™tre 15
        elif v["severity"] == "medium":
            total += 15  # Devrait √™tre 8
        elif v["severity"] == "low":
            total += 25  # Devrait √™tre 3
    return min(total, 100)
# Pourquoi c'est faux : Le score ne refl√®te pas la vraie gravit√©
# Ce qui √©tait pens√© : Confusion dans l'ordre de s√©v√©rit√©
```

```python
# Mutant E (Return) : Retourne toujours un score de 0
def audit_infrastructure(infrastructure):
    if not infrastructure:
        return {"violations": [], "risk_score": 0, "priority_actions": []}

    violations = _detect_all_violations(infrastructure)

    return {
        "violations": violations,
        "risk_score": 0,  # BUG: Hardcod√© √† 0
        "priority_actions": _get_actions(violations)
    }
# Pourquoi c'est faux : Le score de risque est toujours 0
# Ce qui √©tait pens√© : Oubli de calculer le score r√©el
```

---

## üß† SECTION 5 : COMPRENDRE (DOCUMENT DE COURS COMPLET)

### 5.1 Ce que cet exercice enseigne

Cet exercice couvre **8 concepts fondamentaux** de la s√©curit√© informatique :

| Concept | Description | Application dans l'exercice |
|---------|-------------|---------------------------|
| **CIA - Confidentiality** | Les donn√©es ne sont accessibles qu'aux personnes autoris√©es | D√©tecter les flux HTTP pour donn√©es sensibles |
| **CIA - Integrity** | Les donn√©es ne peuvent √™tre modifi√©es que par des personnes autoris√©es | V√©rifier les contr√¥les d'acc√®s en √©criture |
| **CIA - Availability** | Les syst√®mes restent disponibles pour les utilisateurs l√©gitimes | V√©rifier la haute disponibilit√© des services critiques |
| **AAA - Authentication** | V√©rifier l'identit√© des utilisateurs | D√©tecter l'absence de MFA |
| **AAA - Authorization** | V√©rifier les droits d'acc√®s | D√©tecter les endpoints sans auth |
| **AAA - Accounting** | Tracer les actions des utilisateurs | D√©tecter les serveurs sans logs |
| **Defense in Depth** | Multiplier les couches de s√©curit√© | Compter les barri√®res de s√©curit√© |
| **Least Privilege** | Donner uniquement les acc√®s n√©cessaires | Comparer acc√®s r√©els vs requis |

### 5.2 LDA ‚Äî Traduction litt√©rale en fran√ßais (MAJUSCULES)

```
FONCTION audit_infrastructure QUI RETOURNE UN DICTIONNAIRE ET PREND EN PARAM√àTRE infrastructure QUI EST UN DICTIONNAIRE
D√âBUT FONCTION
    SI infrastructure EST √âGAL √Ä NUL OU infrastructure EST VIDE ALORS
        RETOURNER UN DICTIONNAIRE AVEC violations VIDE ET risk_score √Ä 0 ET priority_actions VIDE
    FIN SI

    D√âCLARER violations COMME LISTE VIDE

    POUR CHAQUE utilisateur DANS infrastructure["users"] FAIRE
        SI L'ACC√àS DE utilisateur EST SUP√âRIEUR AU REQUIS ALORS
            AJOUTER UNE VIOLATION "least_privilege" √Ä violations
        FIN SI
    FIN POUR

    POUR CHAQUE serveur DANS infrastructure["servers"] FAIRE
        SI serveur N'A PAS DE LOGS ET serveur EST CRITIQUE ALORS
            AJOUTER UNE VIOLATION "aaa_accounting" √Ä violations
        FIN SI
    FIN POUR

    POUR CHAQUE flux DANS infrastructure["data_flows"] FAIRE
        SI flux UTILISE HTTP ET donn√©es SONT SENSIBLES ALORS
            AJOUTER UNE VIOLATION "cia_confidentiality" √Ä violations
        FIN SI
        SI flux VIENT D'INTERNET ET COUCHES DE S√âCURIT√â INF√âRIEURES √Ä 2 ALORS
            AJOUTER UNE VIOLATION "defense_in_depth" √Ä violations
        FIN SI
    FIN POUR

    AFFECTER LE CALCUL DU SCORE DE RISQUE √Ä risk_score
    AFFECTER LES ACTIONS PRIORITAIRES √Ä priority_actions

    RETOURNER UN DICTIONNAIRE AVEC violations ET risk_score ET priority_actions
FIN FONCTION
```

### 5.2.2.1 Logic Flow (Structured English)

```
ALGORITHME : Audit d'Infrastructure de S√©curit√©
---
1. V√âRIFIER les entr√©es
   SI infrastructure est NULL ou vide :
       RETOURNER rapport vide

2. INITIALISER liste de violations vide

3. ANALYSER les utilisateurs (Least Privilege, Separation of Duties)
   POUR chaque utilisateur :
       a. COMPARER acc√®s_serveurs VS serveurs_requis
       b. SI exc√®s > seuil ‚Üí AJOUTER violation "least_privilege"
       c. V√âRIFIER cumul de r√¥les incompatibles
       d. SI d√©ployer + approuver ‚Üí AJOUTER violation "separation_of_duties"

4. ANALYSER les serveurs (AAA Accounting, CIA Availability)
   POUR chaque serveur :
       a. SI logs d√©sactiv√©s ET serveur critique ‚Üí AJOUTER violation
       b. SI pas de HA ET serveur critique ‚Üí AJOUTER violation

5. ANALYSER les flux de donn√©es (CIA Confidentiality, Defense in Depth)
   POUR chaque flux :
       a. SI HTTP ET donn√©es sensibles ‚Üí AJOUTER violation
       b. SI source=internet ET couches < 2 ‚Üí AJOUTER violation

6. ANALYSER les politiques (Zero Trust, MFA)
   SI auto-approbation permise ‚Üí AJOUTER violation
   SI r√©seau interne trusted ‚Üí AJOUTER violation
   SI MFA non requis ‚Üí AJOUTER violation

7. CALCULER score de risque
   score = SUM(points par s√©v√©rit√©), MAX 100

8. G√âN√âRER actions prioritaires
   TRIER violations par s√©v√©rit√© DESC
   EXTRAIRE top 5 rem√©diations uniques

9. RETOURNER rapport complet
```

### 5.2.3.1 Logique de Garde (Fail Fast)

```
FONCTION : audit_infrastructure (infra)
---
INIT result = {violations: [], risk_score: 0, priority_actions: []}

1. GARDE : Entr√©e invalide
   |
   |-- V√âRIFIER si infra est None :
   |     RETOURNER result (vide)
   |
   |-- V√âRIFIER si infra est un dict vide :
   |     RETOURNER result (vide)

2. ANALYSE UTILISATEURS :
   |
   |-- POUR CHAQUE user dans infra.get("users", []) :
   |     |
   |     |-- GARDE : username manquant
   |     |     CONTINUER au suivant
   |     |
   |     |-- V√âRIFIER least_privilege
   |     |     SI violation ‚Üí AJOUTER √† result.violations
   |     |
   |     |-- V√âRIFIER separation_of_duties
   |           SI violation ‚Üí AJOUTER √† result.violations

3. ANALYSE SERVEURS :
   |
   |-- (structure similaire avec gardes)

4. CALCUL FINAL :
   |
   |-- result.risk_score = MIN(sum_severity_points, 100)
   |-- result.priority_actions = top_5_remediations
   |
   |-- RETOURNER result
```

### 5.3 Visualisation ASCII (adapt√©e au sujet)

**Architecture d'une infrastructure s√©curis√©e vs vuln√©rable :**

```
                    INFRASTRUCTURE VULN√âRABLE

    Internet
        ‚îÇ
        ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇFirewall ‚îÇ  ‚Üê UN SEUL NIVEAU DE D√âFENSE
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò    (violation: defense_in_depth)
        ‚îÇ
        ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ           R√âSEAU "DE CONFIANCE"         ‚îÇ
   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
   ‚îÇ  ‚îÇ Web  ‚îÇ‚îÄ‚îÄ‚îÇ App  ‚îÇ‚îÄ‚îÄ‚îÇ   Database   ‚îÇ  ‚îÇ
   ‚îÇ  ‚îÇServer‚îÇ  ‚îÇServer‚îÇ  ‚îÇ (pas de logs)‚îÇ  ‚îÇ
   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
   ‚îÇ      ‚Üë          ‚îÇ           ‚Üë          ‚îÇ
   ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄHTTP‚îÄ‚îÄ‚îò   (violation:        ‚îÇ
   ‚îÇ   (violation:       aaa_accounting)    ‚îÇ
   ‚îÇ   cia_confidentiality)                 ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üë
           admin_bob (acc√®s √† TOUT)
           (violation: least_privilege)


                    INFRASTRUCTURE S√âCURIS√âE

    Internet
        ‚îÇ
        ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ   WAF   ‚îÇ  ‚Üê Couche 1 : Protection applicative
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇFirewall ‚îÇ  ‚Üê Couche 2 : Filtrage r√©seau
   ‚îÇ  DMZ    ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ   IDS   ‚îÇ  ‚Üê Couche 3 : D√©tection intrusion
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        ‚îÇ      ZONE ZERO TRUST
        ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                              ‚îÇ
   ‚îÇ  ‚îÇ Web  ‚îÇ ‚Üê TLS + Auth + Logs          ‚îÇ
   ‚îÇ  ‚îÇServer‚îÇ                              ‚îÇ
   ‚îÇ  ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò                              ‚îÇ
   ‚îÇ     ‚îÇ                                  ‚îÇ
   ‚îÇ     ‚îÇ TLS (chiffr√©)                    ‚îÇ
   ‚îÇ     ‚ñº                                  ‚îÇ
   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                              ‚îÇ
   ‚îÇ  ‚îÇ App  ‚îÇ ‚Üê Principe Least Privilege   ‚îÇ
   ‚îÇ  ‚îÇServer‚îÇ   (acc√®s segment√©)           ‚îÇ
   ‚îÇ  ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò                              ‚îÇ
   ‚îÇ     ‚îÇ                                  ‚îÇ
   ‚îÇ     ‚îÇ mTLS                             ‚îÇ
   ‚îÇ     ‚ñº                                  ‚îÇ
   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                      ‚îÇ
   ‚îÇ  ‚îÇ   Database   ‚îÇ ‚Üê Logs + HA + Backup ‚îÇ
   ‚îÇ  ‚îÇ  (isolated)  ‚îÇ                      ‚îÇ
   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                      ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Flux de l'algorithme d'audit :**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     D√âBUT        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     OUI    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ infra == None ?  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ return rapport vide‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ NON
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Audit Users      ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫ violations += least_priv, sep_duties
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Audit Servers    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫ violations += accounting, availability
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Audit DataFlows  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫ violations += confidentiality, depth
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Audit Policies   ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫ violations += zero_trust, auth
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Calculate Score  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫ risk_score = min(Œ£ points, 100)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Gen. Actions     ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫ top 5 rem√©diations
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ RETURN rapport   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 5.4 Les pi√®ges en d√©tail

#### Pi√®ge 1 : Les faux positifs ‚Äî "√áa SEMBLE vuln√©rable"

```python
# PI√àGE : Un utilisateur avec beaucoup d'acc√®s n'est PAS forc√©ment en violation
user = {
    "username": "backup_service",
    "server_access": ["srv1", "srv2", "srv3", "srv4", "srv5", ...],
    "required_servers": ["srv1", "srv2", "srv3", "srv4", "srv5", ...]  # Tous requis !
}
# Ce compte de service a besoin de tous ces acc√®s pour les backups
# ‚Üí PAS de violation si acc√®s = requis
```

#### Pi√®ge 2 : Le HTTP "interne" ‚Äî "C'est dans notre r√©seau"

```python
# PI√àGE : HTTP interne pour donn√©es PCI-DSS est TOUJOURS une violation
flow = {
    "protocol": "http",
    "internal": True,  # Dans le r√©seau interne
    "data_classification": "pci_dss"  # Mais donn√©es carte bancaire !
}
# PCI-DSS exige le chiffrement PARTOUT, m√™me en interne
# ‚Üí Violation cia_confidentiality m√™me si "internal": True
```

#### Pi√®ge 3 : Le calcul du score ‚Äî Overflow √† 100

```python
# PI√àGE : Le score NE PEUT PAS d√©passer 100
violations = [
    {"severity": "critical"},  # 25
    {"severity": "critical"},  # 25
    {"severity": "critical"},  # 25
    {"severity": "critical"},  # 25
    {"severity": "critical"},  # 25 ‚Üí Total = 125
]
# Le score doit √™tre cap√© √† 100
risk_score = min(sum(...), 100)  # 100, pas 125
```

#### Pi√®ge 4 : Les r√¥les incompatibles ‚Äî "Mais c'est pratique"

```python
# PI√àGE : deployer + approver sur la m√™me personne
user = {
    "username": "devops_lead",
    "roles": ["deployer", "approver"],  # Cumul dangereux
    "justification": "C'est le tech lead"  # Pas une excuse !
}
# Separation of Duties s'applique TOUJOURS
# ‚Üí Violation m√™me si "c'est le boss"
```

### 5.5 Cours Complet (VRAI cours, pas un r√©sum√©)

#### 5.5.1 La Triade CIA : Le Triangle d'Or de la S√©curit√©

La **triade CIA** (Confidentiality, Integrity, Availability) est le fondement de toute politique de s√©curit√©. Ces trois piliers sont souvent en tension : renforcer l'un peut affaiblir les autres.

**Confidentiality (Confidentialit√©)**

La confidentialit√© garantit que les informations ne sont accessibles qu'aux personnes, entit√©s ou processus autoris√©s.

*M√©canismes de mise en ≈ìuvre :*
- Chiffrement (AES, RSA, TLS)
- Contr√¥le d'acc√®s (RBAC, ABAC)
- Classification des donn√©es (Public, Internal, Confidential, Secret)
- Segmentation r√©seau (VLANs, microsegmentation)

*Violations courantes dans l'exercice :*
```python
# Donn√©es sensibles en HTTP
{"protocol": "http", "data_classification": "confidential"}
# Base de donn√©es accessible depuis Internet
{"source": "internet", "destination": "database"}
```

**Integrity (Int√©grit√©)**

L'int√©grit√© garantit que les donn√©es n'ont pas √©t√© modifi√©es de mani√®re non autoris√©e et restent exactes et compl√®tes.

*M√©canismes de mise en ≈ìuvre :*
- Hachage (SHA-256, BLAKE3)
- Signatures num√©riques
- Contr√¥le de version
- Checksums et HMAC

*Violations courantes :*
```python
# Pas de v√©rification d'int√©grit√© sur les fichiers de configuration
{"config_files": {"integrity_check": False}}
# API sans validation des entr√©es
{"input_validation": False}
```

**Availability (Disponibilit√©)**

La disponibilit√© garantit que les syst√®mes et donn√©es sont accessibles quand les utilisateurs l√©gitimes en ont besoin.

*M√©canismes de mise en ≈ìuvre :*
- Haute disponibilit√© (clustering, load balancing)
- Sauvegardes et PRA/PCA
- Protection DDoS
- Redondance (N+1, actif-passif, actif-actif)

*Violations courantes :*
```python
# Serveur critique sans HA
{"type": "payment", "high_availability": False}
# Pas de backup
{"backup_policy": None}
```

#### 5.5.2 AAA : Authentication, Authorization, Accounting

Le framework **AAA** d√©finit comment g√©rer les identit√©s et les acc√®s.

**Authentication (Authentification)**

Processus de v√©rification de l'identit√© d'un utilisateur ou syst√®me.

*Facteurs d'authentification :*
1. **Ce que vous savez** : mot de passe, PIN, question secr√®te
2. **Ce que vous poss√©dez** : token, smartphone, carte √† puce
3. **Ce que vous √™tes** : biom√©trie (empreinte, visage, iris)
4. **O√π vous √™tes** : g√©olocalisation, adresse IP
5. **Ce que vous faites** : comportement, pattern de frappe

*MFA (Multi-Factor Authentication) :*
Combine au moins 2 facteurs de cat√©gories diff√©rentes.

```python
# Violation : pas de MFA sur comptes privil√©gi√©s
{"authentication": {"mfa_required": False, "admin_accounts": True}}
```

**Authorization (Autorisation)**

Processus de v√©rification des droits d'acc√®s apr√®s authentification.

*Mod√®les d'autorisation :*
- **DAC** (Discretionary Access Control) : le propri√©taire d√©cide
- **MAC** (Mandatory Access Control) : l'organisation d√©cide
- **RBAC** (Role-Based) : bas√© sur les r√¥les
- **ABAC** (Attribute-Based) : bas√© sur les attributs
- **PBAC** (Policy-Based) : bas√© sur des politiques

```python
# Violation : endpoint public sans authorization
{"public_endpoints": ["/api/users"], "authentication_required": False}
```

**Accounting (Tra√ßabilit√©)**

Enregistrement des actions pour audit, forensics et compliance.

*√âl√©ments √† tracer :*
- Qui (identit√©)
- Quoi (action)
- Quand (timestamp)
- O√π (IP, localisation)
- Comment (m√©thode, outil)
- R√©sultat (succ√®s/√©chec)

```python
# Violation : pas de logs sur serveur critique
{"name": "payment_server", "logging_enabled": False}
```

#### 5.5.3 Principes de S√©curit√© Avanc√©s

**Defense in Depth (D√©fense en Profondeur)**

Strat√©gie consistant √† impl√©menter plusieurs couches de s√©curit√©.

*Les 7 couches typiques :*
1. **P√©rim√®tre** : firewall, WAF, IDS/IPS
2. **R√©seau** : segmentation, VPN, microsegmentation
3. **H√¥te** : hardening, EDR, patching
4. **Application** : secure coding, input validation
5. **Donn√©es** : chiffrement, DLP, classification
6. **Identit√©** : IAM, PAM, MFA
7. **Humain** : sensibilisation, phishing tests

```
Internet ‚Üí WAF ‚Üí Firewall ‚Üí IDS ‚Üí Segmentation ‚Üí Application ‚Üí Donn√©es
           ‚Üë      ‚Üë        ‚Üë         ‚Üë             ‚Üë           ‚Üë
         Couche  Couche   Couche   Couche       Couche     Couche
           1       2        3        4            5          6
```

**Least Privilege (Moindre Privil√®ge)**

Chaque utilisateur, processus ou syst√®me ne doit avoir que les privil√®ges strictement n√©cessaires.

*Application pratique :*
```python
# MAUVAIS : admin a acc√®s √† tout
admin_bob = {"server_access": ["*"], "required": ["srv1", "srv2"]}

# BON : acc√®s limit√© au n√©cessaire
admin_bob = {"server_access": ["srv1", "srv2"], "required": ["srv1", "srv2"]}
```

**Separation of Duties (S√©paration des T√¢ches)**

Aucun individu ne doit pouvoir accomplir seul une t√¢che critique.

*Paires de r√¥les √† s√©parer :*
- D√©veloppeur / Approver des changements
- Administrateur / Auditeur
- Tr√©sorier / Approbateur des paiements
- DBA / Auditeur de donn√©es

```python
# VIOLATION
{"roles": ["deployer", "approver"]}  # Peut d√©ployer ET approuver ses propres changements

# CORRECT
# User A: {"roles": ["deployer"]}
# User B: {"roles": ["approver"]}
```

**Zero Trust**

"Never trust, always verify" ‚Äî Ne jamais faire confiance, toujours v√©rifier.

*Principes fondamentaux :*
1. V√©rifier explicitement (identit√©, device, localisation)
2. Acc√®s avec moindre privil√®ge
3. Assumer la compromission (breach assumption)

```python
# VIOLATION : faire confiance au r√©seau interne
{"network": {"trust_internal": True}}

# CORRECT : v√©rifier m√™me en interne
{"network": {"trust_internal": False, "verify_all_requests": True}}
```

### 5.6 Normes avec explications p√©dagogiques

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ùå HORS NORME (compile, mais interdit)                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ def audit(infra):                                               ‚îÇ
‚îÇ     return {"violations": [...]}                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚úÖ CONFORME                                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ def audit_infrastructure(infrastructure: dict) -> dict:         ‚îÇ
‚îÇ     """                                                         ‚îÇ
‚îÇ     Analyse une infrastructure de s√©curit√©.                     ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ     Args:                                                       ‚îÇ
‚îÇ         infrastructure: Structure contenant servers, users...   ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ     Returns:                                                    ‚îÇ
‚îÇ         Rapport d'audit avec violations et score de risque      ‚îÇ
‚îÇ     """                                                         ‚îÇ
‚îÇ     if infrastructure is None:                                  ‚îÇ
‚îÇ         return {"violations": [], "risk_score": 0, ...}         ‚îÇ
‚îÇ     # ...                                                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üìñ POURQUOI ?                                                   ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ ‚Ä¢ Type hints : Documentent l'API pour les utilisateurs          ‚îÇ
‚îÇ ‚Ä¢ Docstring : Explique le comportement                          ‚îÇ
‚îÇ ‚Ä¢ Nom explicite : audit_infrastructure > audit                  ‚îÇ
‚îÇ ‚Ä¢ Gestion None : Code d√©fensif contre entr√©es invalides         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ùå HORS NORME                                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ violations.append({"principle": "least_priv", ...})             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚úÖ CONFORME                                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ PRINCIPLES = {                                                  ‚îÇ
‚îÇ     "LEAST_PRIVILEGE": "least_privilege",                       ‚îÇ
‚îÇ     "DEFENSE_IN_DEPTH": "defense_in_depth",                     ‚îÇ
‚îÇ     # ...                                                       ‚îÇ
‚îÇ }                                                               ‚îÇ
‚îÇ violations.append({"principle": PRINCIPLES["LEAST_PRIVILEGE"]}) ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üìñ POURQUOI ?                                                   ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ ‚Ä¢ Constantes : √âvite les typos ("lest_priv" vs "least_priv")    ‚îÇ
‚îÇ ‚Ä¢ Maintenabilit√© : Un seul endroit √† modifier                   ‚îÇ
‚îÇ ‚Ä¢ Autocompl√©tion : L'IDE sugg√®re les valeurs valides            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 5.7 Simulation avec trace d'ex√©cution

**Entr√©e :**
```python
infrastructure = {
    "users": [
        {"username": "admin_bob", "server_access": ["srv1", "srv2", ..., "srv15"],
         "required_servers": ["srv1", "srv2"]}
    ],
    "servers": [
        {"name": "payment_server", "type": "payment", "logging_enabled": False}
    ],
    "data_flows": [
        {"source": "app", "destination": "db", "protocol": "http",
         "data_classification": "pci_dss"}
    ],
    "policies": {}
}
```

**Trace d'ex√©cution :**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ √âtape ‚îÇ Instruction                                    ‚îÇ violations               ‚îÇ Explication                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   1   ‚îÇ V√âRIFIER infrastructure != None                ‚îÇ []                       ‚îÇ infrastructure existe ‚Üí OK     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   2   ‚îÇ ANALYSER users[0]: admin_bob                   ‚îÇ []                       ‚îÇ D√©but analyse utilisateur      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   3   ‚îÇ server_access=15, required=2, exc√®s=13        ‚îÇ []                       ‚îÇ Calcul de l'exc√®s d'acc√®s      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   4   ‚îÇ 13 > 2*2 ? OUI ‚Üí VIOLATION                    ‚îÇ [{least_privilege}]      ‚îÇ Exc√®s > seuil ‚Üí violation      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   5   ‚îÇ ANALYSER servers[0]: payment_server           ‚îÇ [{least_privilege}]      ‚îÇ D√©but analyse serveur          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   6   ‚îÇ logging_enabled=False ET type=payment         ‚îÇ [{least_priv},           ‚îÇ Serveur critique sans logs     ‚îÇ
‚îÇ       ‚îÇ ‚Üí VIOLATION                                   ‚îÇ  {aaa_accounting}]       ‚îÇ                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   7   ‚îÇ ANALYSER data_flows[0]: app‚Üídb                ‚îÇ [{...}, {...}]           ‚îÇ D√©but analyse flux             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   8   ‚îÇ protocol=HTTP ET classification=pci_dss       ‚îÇ [{...}, {...},           ‚îÇ Donn√©es PCI en clair           ‚îÇ
‚îÇ       ‚îÇ ‚Üí VIOLATION                                   ‚îÇ  {cia_confidentiality}]  ‚îÇ                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   9   ‚îÇ CALCULER risk_score                           ‚îÇ 3 violations             ‚îÇ critical(25)+critical(25)+     ‚îÇ
‚îÇ       ‚îÇ                                               ‚îÇ                          ‚îÇ critical(25) = 75              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  10   ‚îÇ G√âN√âRER priority_actions                      ‚îÇ score=75                 ‚îÇ Top 3 rem√©diations             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  11   ‚îÇ RETOURNER rapport                             ‚îÇ FINAL                    ‚îÇ R√©sultat: 3 viols, score 75    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 5.8 Mn√©motechniques (MEME obligatoire)

#### üî• MEME : "This is fine" ‚Äî Ne pas ignorer les violations

![This is fine](meme_this_is_fine.jpg)

*"HTTP pour les donn√©es PCI-DSS ? C'est interne, √ßa devrait aller..."*

Comme le chien dans le meme "This is fine" qui ignore les flammes autour de lui, un d√©veloppeur qui ignore les violations de s√©curit√© "parce que c'est interne" va finir carbonis√© par un audit PCI-DSS.

```python
# üî• Ne sois pas ce chien !
if protocol == "http" and classification == "pci_dss":
    # "This is fine" ‚Üí NON ! C'est une violation !
    violations.append({"principle": "cia_confidentiality", ...})
```

---

#### üè¥‚Äç‚ò†Ô∏è MEME : "Luffy v√©rifie toujours ses nakamas" ‚Äî Least Privilege

Dans One Piece, Luffy ne donne pas les cl√©s du Sunny √† n'importe qui. Seul Franky peut vraiment tout faire sur le navire.

Pareil pour toi : **chaque utilisateur n'a acc√®s qu'√† ce dont il a VRAIMENT besoin**.

```python
# Luffy ne donnerait pas les commandes √† tous
if len(server_access) > len(required_servers) * 2:
    # "Tu n'as pas besoin d'acc√©der √† la r√©serve de viande, Zoro !"
    violations.append({"principle": "least_privilege", ...})
```

---

#### üíÄ MEME : "You shall not pass!" ‚Äî Defense in Depth

Comme Gandalf sur le pont de Khazad-d√ªm, chaque couche de s√©curit√© doit bloquer les menaces.

**UN SEUL Gandalf ne suffit pas** ‚Äî il faut plusieurs couches !

```python
if len(security_layers) < 2 and source == "internet":
    # "Un seul Gandalf ? Le Balrog va passer !"
    violations.append({"principle": "defense_in_depth", ...})
```

---

#### üìù MEME : "Press F to pay respects" ‚Äî AAA Accounting (Logs)

Chaque serveur sans logs m√©rite un F.

Quand l'incident arrivera et qu'il n'y aura pas de traces... **F**

```python
if not logging_enabled and server_type == "critical":
    # Press F to pay respects to your forensics team
    violations.append({"principle": "aaa_accounting", ...})
```

---

#### üé≠ MEME : "S√©paration des pouvoirs" ‚Äî Separation of Duties

Imagine si le pr√©sident pouvait aussi √™tre juge ET l√©gislateur. C'est exactement ce qu'on √©vite avec Separation of Duties.

```python
if "deployer" in roles and "approver" in roles:
    # "Je suis le S√©nat !" ‚Äî Palpatine, juste avant de mal tourner
    violations.append({"principle": "separation_of_duties", ...})
```

### 5.9 Applications pratiques

| Domaine | Application de l'exercice |
|---------|--------------------------|
| **Audit PCI-DSS** | V√©rifier la conformit√© des syst√®mes de paiement |
| **Due Diligence M&A** | √âvaluer la posture s√©curit√© d'une cible d'acquisition |
| **Pentest initial** | Cartographier les faiblesses avant test d'intrusion |
| **Certification ISO 27001** | Pr√©parer l'audit de certification |
| **Revue architecture** | Valider un nouveau design avant mise en production |
| **Incident Response** | Identifier les faiblesses exploit√©es lors d'une br√®che |

---

## ‚ö†Ô∏è SECTION 6 : PI√àGES ‚Äî R√âCAPITULATIF

| # | Pi√®ge | Erreur courante | Solution |
|---|-------|-----------------|----------|
| 1 | Entr√©es nulles | `infrastructure["users"]` crash si None | Toujours v√©rifier `if infrastructure is None` |
| 2 | Faux positifs | Signaler toute config comme vuln√©rable | Comparer acc√®s r√©els vs requis |
| 3 | Score overflow | Score > 100 | `min(total, 100)` |
| 4 | HTTP interne | Ignorer car "r√©seau interne" | PCI-DSS exige chiffrement partout |
| 5 | R√¥les cumul√©s | Accepter si "c'est le lead" | Separation of Duties s'applique toujours |
| 6 | Cl√©s manquantes | `user["roles"]` KeyError | `.get("roles", [])` |
| 7 | Logs optionnels | Ignorer l'absence de logs | Serveurs critiques DOIVENT avoir des logs |

---

## üìù SECTION 7 : QCM

**Q1.** Quels sont les trois piliers de la triade CIA ?

- A) Confidentiality, Identity, Availability
- B) Confidentiality, Integrity, Authentication
- C) Confidentiality, Integrity, Availability ‚úì
- D) Control, Integrity, Authorization
- E) Compliance, Identity, Authentication
- F) Cryptography, Integrity, Access
- G) C, I, et A sont corrects mais l'ordre diff√®re
- H) Confidentiality, Isolation, Availability
- I) Consensus, Integrity, Availability
- J) Aucune des r√©ponses ci-dessus

**Q2.** Un utilisateur a acc√®s √† 15 serveurs mais n'en utilise que 2. Quel principe est viol√© ?

- A) Defense in Depth
- B) Zero Trust
- C) Least Privilege ‚úì
- D) Separation of Duties
- E) AAA Authentication
- F) CIA Confidentiality
- G) Attack Surface (partiellement correct)
- H) Non-Repudiation
- I) AAA Accounting
- J) Security by Design

**Q3.** Que signifie "Zero Trust" ?

- A) Ne jamais faire confiance aux utilisateurs externes
- B) Ne jamais faire confiance, toujours v√©rifier ‚úì
- C) Supprimer tous les acc√®s
- D) Chiffrer toutes les communications
- E) Utiliser uniquement l'authentification biom√©trique
- F) Ne pas utiliser de firewall (car on ne fait pas confiance)
- G) Faire confiance uniquement au r√©seau interne
- H) Impl√©menter MFA pour tous
- I) Segmenter le r√©seau en zones
- J) Monitorer tout le trafic

**Q4.** Une √©quipe DevOps peut d√©ployer ET approuver ses propres changements. Quelle violation ?

- A) Least Privilege
- B) Defense in Depth
- C) AAA Authorization
- D) Separation of Duties ‚úì
- E) Zero Trust
- F) CIA Integrity
- G) Non-Repudiation
- H) Attack Surface
- I) AAA Accounting
- J) Security Policies

**Q5.** Un serveur de paiement n'a pas de logs activ√©s. Quelle est la violation principale ?

- A) CIA Confidentiality
- B) CIA Integrity
- C) CIA Availability
- D) AAA Authentication
- E) AAA Authorization
- F) AAA Accounting ‚úì
- G) Defense in Depth
- H) Least Privilege
- I) Separation of Duties
- J) Zero Trust

**Q6.** Des donn√©es PCI-DSS transitent en HTTP sur le r√©seau interne. C'est acceptable ?

- A) Oui, c'est interne donc s√©curis√©
- B) Oui, si le r√©seau est segment√©
- C) Non, PCI-DSS exige le chiffrement partout ‚úì
- D) Oui, si c'est temporaire
- E) Non, sauf avec VPN interne
- F) Oui, si MFA est activ√©
- G) D√©pend de la version PCI-DSS
- H) Oui, avec monitoring
- I) Non, c'est ill√©gal
- J) Oui, si valid√© par le QSA

**Q7.** Combien de couches de s√©curit√© minimum recommande Defense in Depth pour un acc√®s depuis Internet vers des donn√©es sensibles ?

- A) 1 couche (firewall suffit)
- B) 2 couches minimum ‚úì
- C) 3 couches exactement
- D) 5 couches obligatoires
- E) 7 couches (mod√®le OSI)
- F) Aucune si Zero Trust
- G) D√©pend du framework
- H) 4 couches (p√©rim√®tre, r√©seau, h√¥te, application)
- I) 10 couches
- J) Illimit√©, toujours plus

**Q8.** Comment calculer le score de risque si vous avez 3 violations critical et 2 high ?

- A) 3 + 2 = 5 points
- B) (3 √ó 25) + (2 √ó 15) = 105, cap√© √† 100 ‚úì
- C) 3 √ó 3 + 2 √ó 2 = 13 points
- D) 100 (automatiquement max si critical)
- E) (3 + 2) √ó 10 = 50 points
- F) 75 points (3 critical seulement)
- G) 30 points (2 high seulement)
- H) Moyenne des s√©v√©rit√©s
- I) 5 √ó 20 = 100 points
- J) Non calculable sans plus d'info

**Q9.** Quel framework utilise les cat√©gories STRIDE pour la mod√©lisation des menaces ?

- A) NIST CSF
- B) ISO 27001
- C) Microsoft Threat Modeling ‚úì
- D) OWASP Top 10
- E) CIS Controls
- F) COBIT
- G) FAIR
- H) MITRE ATT&CK
- I) PCI-DSS
- J) GDPR

**Q10.** Dans le mod√®le AAA, que repr√©sente le second A (Authorization) ?

- A) V√©rification de l'identit√©
- B) Enregistrement des actions
- C) V√©rification des droits d'acc√®s ‚úì
- D) Gestion des mots de passe
- E) Audit de conformit√©
- F) Analyse de risque
- G) Attribution des r√¥les
- H) Authentification √† deux facteurs
- I) Alerte de s√©curit√©
- J) Acc√®s physique

---

## üìä SECTION 8 : R√âCAPITULATIF

| √âl√©ment | Valeur |
|---------|--------|
| **Exercice ID** | 3.1.1-a |
| **Nom** | auditeur_forteresse |
| **Module** | 3.1.1 ‚Äî Principes Fondamentaux de S√©curit√© |
| **Concepts couverts** | 8 (CIA, AAA, Defense in Depth, Least Privilege, Separation of Duties, Zero Trust, Attack Surface, Non-Repudiation) |
| **Difficult√©** | 7/10 (‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ) |
| **Difficult√© Bonus** | 8/10 (‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ) |
| **Type** | complet (cours + QCM + code) |
| **Langage** | Python 3.14 |
| **XP Base** | 150 |
| **XP Bonus** | 300 (√ó2) |
| **Dur√©e estim√©e** | 90 min |
| **Tests fournis** | 10 tests unitaires |
| **Mutants** | 5 (Boundary, Safety, Resource, Logic, Return) |

---

## üì¶ SECTION 9 : DEPLOYMENT PACK (JSON COMPLET)

```json
{
  "deploy": {
    "hackbrain_version": "5.5.2",
    "engine_version": "v22.1",
    "exercise_slug": "3.1.1-a-auditeur-forteresse",
    "generated_at": "2026-01-11 14:30:00",

    "metadata": {
      "exercise_id": "3.1.1-a",
      "exercise_name": "auditeur_forteresse",
      "module": "3.1.1",
      "module_name": "Principes Fondamentaux de S√©curit√©",
      "concept": "a-h",
      "concept_name": "CIA, AAA, Defense in Depth, Least Privilege, Separation of Duties, Zero Trust, Attack Surface",
      "type": "complet",
      "tier": 2,
      "tier_info": "M√©lange (concepts a-h)",
      "phase": 3,
      "difficulty": 7,
      "difficulty_stars": "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ",
      "language": "python",
      "duration_minutes": 90,
      "xp_base": 150,
      "xp_bonus_multiplier": 2,
      "bonus_tier": "STANDARD",
      "bonus_icon": "‚ö°",
      "complexity_time": "T3 O(n√óm)",
      "complexity_space": "S2 O(n)",
      "prerequisites": ["Phase 2 compl√®te", "JSON", "Dictionnaires Python"],
      "domains": ["Crypto", "Net", "FS"],
      "domains_bonus": ["Struct", "MD"],
      "tags": ["security", "audit", "cia", "aaa", "defense-in-depth", "least-privilege", "phase3"],
      "meme_reference": "This is fine, Luffy nakamas, You shall not pass, Press F"
    },

    "files": {
      "spec.json": "/* Section 4.9 */",
      "references/ref_auditeur_forteresse.py": "/* Section 4.3 */",
      "references/ref_auditeur_forteresse_bonus.py": "/* Section 4.6 */",
      "alternatives/alt_oop.py": "/* Section 4.4 Alternative 1 */",
      "alternatives/alt_functional.py": "/* Section 4.4 Alternative 2 */",
      "mutants/mutant_a_boundary.py": "/* Section 4.10 Mutant A */",
      "mutants/mutant_b_safety.py": "/* Section 4.10 Mutant B */",
      "mutants/mutant_c_resource.py": "/* Section 4.10 Mutant C */",
      "mutants/mutant_d_logic.py": "/* Section 4.10 Mutant D */",
      "mutants/mutant_e_return.py": "/* Section 4.10 Mutant E */",
      "tests/main.py": "/* Section 4.2 */",
      "tests/test_infrastructure.json": "/* Infrastructure de test compl√®te */"
    },

    "validation": {
      "expected_pass": [
        "references/ref_auditeur_forteresse.py",
        "references/ref_auditeur_forteresse_bonus.py",
        "alternatives/alt_oop.py",
        "alternatives/alt_functional.py"
      ],
      "expected_fail": [
        "mutants/mutant_a_boundary.py",
        "mutants/mutant_b_safety.py",
        "mutants/mutant_c_resource.py",
        "mutants/mutant_d_logic.py",
        "mutants/mutant_e_return.py"
      ]
    },

    "commands": {
      "validate_spec": "python3 hackbrain_engine_v22.py --validate-spec spec.json",
      "test_reference": "python3 hackbrain_engine_v22.py -s spec.json -f references/ref_auditeur_forteresse.py",
      "test_mutants": "python3 hackbrain_mutation_tester.py -r references/ref_auditeur_forteresse.py -s spec.json --validate"
    }
  }
}
```

---

*Document g√©n√©r√© selon HACKBRAIN v5.5.2*
*"L'excellence p√©dagogique ne se n√©gocie pas ‚Äî pas de raccourcis"*
*Compatible ENGINE v22.1 + Mutation Tester*
