# ex22: Threat Modeling & Penetration Testing

**Module**: 2.9 - Computer Security
**Difficulte**: Intermediaire
**Duree**: 4h
**Score qualite**: 96/100

## Concepts Couverts

### 2.9.42: Threat Modeling (7 concepts)
| Ref | Concept | Application |
|-----|---------|-------------|
| a | Purpose | Identify threats |
| b | STRIDE | Spoofing, Tampering, Repudiation, Info disclosure, DoS, Elevation |
| c | Attack trees | Visual representation |
| d | Trust boundaries | Where trust changes |
| e | Data flow diagrams | System overview |
| f | Risk assessment | Likelihood x impact |
| g | Mitigations | Address threats |

### 2.9.43: Penetration Testing (7 concepts)
| Ref | Concept | Application |
|-----|---------|-------------|
| a | Phases | Recon, scan, exploit, post-exploit, report |
| b | Reconnaissance | Gather information |
| c | Scanning | Find vulnerabilities |
| d | Exploitation | Prove vulnerability |
| e | Post-exploitation | Pivot, persist |
| f | Reporting | Document findings |
| g | Legal | Authorization required |

---

## Sujet

Maitriser la modelisation des menaces et les bases du test d'intrusion.

---

## Exemple

```c
#include "threat_pentesting.h"

int main(void) {
    printf("=== Threat Modeling ===\n\n");

    // Purpose
    printf("What is Threat Modeling?\n");
    printf("  Systematic process to identify security threats\n");
    printf("  Done BEFORE implementation (shift left)\n");
    printf("  Answers:\n");
    printf("    - What are we building?\n");
    printf("    - What can go wrong?\n");
    printf("    - What are we going to do about it?\n");
    printf("    - Did we do a good job?\n");

    // STRIDE
    printf("\n\n=== STRIDE Framework ===\n\n");

    printf("STRIDE - Microsoft threat categories:\n\n");

    printf("S - Spoofing Identity:\n");
    printf("    Pretending to be someone else\n");
    printf("    Examples: Stolen credentials, forged tokens\n");
    printf("    Mitigations: Strong auth, MFA\n");

    printf("\nT - Tampering:\n");
    printf("    Modifying data or code\n");
    printf("    Examples: SQL injection, file modification\n");
    printf("    Mitigations: Input validation, integrity checks\n");

    printf("\nR - Repudiation:\n");
    printf("    Denying an action was performed\n");
    printf("    Examples: No audit logs, unsigned transactions\n");
    printf("    Mitigations: Logging, digital signatures\n");

    printf("\nI - Information Disclosure:\n");
    printf("    Exposing data to unauthorized parties\n");
    printf("    Examples: Error messages, data leaks\n");
    printf("    Mitigations: Encryption, access control\n");

    printf("\nD - Denial of Service:\n");
    printf("    Making system unavailable\n");
    printf("    Examples: DDoS, resource exhaustion\n");
    printf("    Mitigations: Rate limiting, redundancy\n");

    printf("\nE - Elevation of Privilege:\n");
    printf("    Gaining unauthorized access\n");
    printf("    Examples: Privilege escalation, IDOR\n");
    printf("    Mitigations: Least privilege, authorization checks\n");

    // Data Flow Diagram
    printf("\n\n=== Data Flow Diagrams ===\n\n");

    printf("Components:\n");
    printf("  [ ] External Entity (user, external system)\n");
    printf("  ( ) Process (your code)\n");
    printf("  = = Data Store (database, file)\n");
    printf("  --> Data Flow (arrows)\n");
    printf("  --- Trust Boundary (dashed line)\n");

    printf("\n  Example Web App:\n");
    printf("  +--------------------------------------------------+\n");
    printf("  |                    Internet                       |\n");
    printf("  |  [User] --HTTPS--> (Web Server)                  |\n");
    printf("  +---------------------|-----------------------------+\n");
    printf("                        | Trust Boundary\n");
    printf("  +---------------------|-----------------------------+\n");
    printf("  |  Internal Network   v                             |\n");
    printf("  |              (App Server) --SQL--> = Database =   |\n");
    printf("  +--------------------------------------------------+\n");

    // Trust Boundaries
    printf("\n\n=== Trust Boundaries ===\n\n");

    printf("Where trust level changes:\n");
    printf("  - Internet <-> DMZ\n");
    printf("  - DMZ <-> Internal network\n");
    printf("  - User input <-> Application\n");
    printf("  - Process <-> Kernel\n");
    printf("  - App <-> Database\n");
    printf("\n  Data crossing boundaries needs validation!\n");

    // Attack Trees
    printf("\n\n=== Attack Trees ===\n\n");

    printf("Visual hierarchy of attack paths:\n");
    printf("\n  Goal: Steal User Data\n");
    printf("        |\n");
    printf("    +---+---+\n");
    printf("    |       |\n");
    printf("  SQLi    XSS\n");
    printf("    |       |\n");
    printf("  +---+   Stored\n");
    printf("  |   |     |\n");
    printf(" Union Blind Cookie\n");
    printf("             Theft\n");

    // Risk Assessment
    printf("\n\n=== Risk Assessment ===\n\n");

    printf("Risk = Likelihood x Impact\n");
    printf("\n  Likelihood factors:\n");
    printf("    - Attacker skill required\n");
    printf("    - Attack complexity\n");
    printf("    - Exposure (public vs internal)\n");
    printf("\n  Impact factors:\n");
    printf("    - Data sensitivity\n");
    printf("    - System criticality\n");
    printf("    - Regulatory requirements\n");

    printf("\n  Risk Matrix:\n");
    printf("         |  Low    Med    High  Impact\n");
    printf("  -------+------------------------\n");
    printf("  High   |  Med    High   Crit\n");
    printf("  Med    |  Low    Med    High\n");
    printf("  Low    |  Low    Low    Med\n");
    printf("  Likelihood\n");

    // Penetration Testing
    printf("\n\n=== Penetration Testing ===\n\n");

    printf("Authorized simulated attack to find vulnerabilities\n");
    printf("\n  Types:\n");
    printf("    Black box: No prior knowledge\n");
    printf("    White box: Full access to source/docs\n");
    printf("    Gray box: Partial knowledge\n");

    // Phases
    printf("\n\n=== Pentest Phases ===\n\n");

    printf("1. RECONNAISSANCE:\n");
    printf("   Passive:\n");
    printf("     - OSINT (Open Source Intelligence)\n");
    printf("     - DNS records, WHOIS\n");
    printf("     - Social media, job postings\n");
    printf("     - Google dorking\n");
    printf("   Active:\n");
    printf("     - Port scanning\n");
    printf("     - Service enumeration\n");

    printf("\n2. SCANNING:\n");
    printf("   - Port scanning (nmap)\n");
    printf("   - Vulnerability scanning (Nessus, OpenVAS)\n");
    printf("   - Web scanning (Nikto, OWASP ZAP)\n");
    printf("   - Directory enumeration (gobuster, dirb)\n");

    printf("\n3. EXPLOITATION:\n");
    printf("   - Exploit vulnerabilities found\n");
    printf("   - Gain initial access\n");
    printf("   - Prove impact\n");
    printf("   - Document everything\n");

    printf("\n4. POST-EXPLOITATION:\n");
    printf("   - Privilege escalation\n");
    printf("   - Lateral movement\n");
    printf("   - Persistence (if authorized)\n");
    printf("   - Data exfiltration (simulated)\n");

    printf("\n5. REPORTING:\n");
    printf("   - Executive summary\n");
    printf("   - Technical findings\n");
    printf("   - Risk ratings\n");
    printf("   - Remediation recommendations\n");
    printf("   - Evidence/screenshots\n");

    // Legal
    printf("\n\n=== Legal Considerations ===\n\n");

    printf("CRITICAL: Always have written authorization!\n");
    printf("\n  Required:\n");
    printf("    - Scope definition (what systems)\n");
    printf("    - Time window\n");
    printf("    - Contact information\n");
    printf("    - Get-out-of-jail letter\n");
    printf("    - Rules of engagement\n");

    printf("\n  Laws:\n");
    printf("    - CFAA (Computer Fraud and Abuse Act) - US\n");
    printf("    - Computer Misuse Act - UK\n");
    printf("    - Similar laws globally\n");
    printf("\n  Unauthorized testing = criminal offense!\n");

    // Methodology
    printf("\n\n=== Pentest Methodology ===\n\n");
    printf("  OWASP Testing Guide: Web applications\n");
    printf("  PTES: Penetration Testing Execution Standard\n");
    printf("  OSSTMM: Open Source Security Testing Methodology\n");
    printf("  NIST SP 800-115: Technical Guide to Testing\n");

    return 0;
}
```

---

## Fichiers

```
ex22/
├── threat_pentesting.h
├── threat_modeling.c
├── stride.c
├── pentest_phases.c
└── Makefile
```
